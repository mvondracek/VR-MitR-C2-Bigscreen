<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>WebSocket demo</title>
    </head>
    <body>
        <h1>WebSocket Test</h1>
        <button id="btn_socket_connect">connect</button>
        <button id="btn_socket_register">register</button>
        <button id="btn_socket_send">send</button>
        <button id="btn_socket_close">close</button>
        <div id="output"></div>


        <!--[if lte IE 9]>
<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.1.10/es5-shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
<![endif]-->
<script src="./msgpack.min.js"></script>
<script>
const wsUri = "ws://172.26.104.1:8090/";
var output;
var websocket;
const btn_socket_close = document.getElementById('btn_socket_close');
const btn_socket_register = document.getElementById('btn_socket_register');
const btn_socket_send = document.getElementById('btn_socket_send');
const btn_socket_connect = document.getElementById('btn_socket_connect');

function connect() {
    output = document.getElementById("output");
    websocket = new WebSocket(wsUri);
    websocket.binaryType = 'arraybuffer';
    websocket.onopen = function (event) {
        onOpen(event)
    };
    websocket.onclose = function (event) {
        onClose(event)
    };
    websocket.onmessage = function (event) {
        onMessage(event)
    };
    websocket.onerror = function (event) {
        onError(event)
    };

    btn_socket_register.addEventListener("click", function () {
        doSend({type: 'box-register'});
    });
    btn_socket_send.addEventListener("click", function () {
        doSend(
{
  "type": "admin",
  "action": "kick"
}
            );
    });
    btn_socket_close.addEventListener("click", function () {
        websocket.close();
    });
}
btn_socket_connect.addEventListener("click", function(){connect()});

function onOpen(event) {
    console.log('onOpen connected');
}

function onClose(event) {
    console.log('onClose disconnected');
}

function onMessage(event) {
    var msg = msgpack.decode(new Uint8Array(event.data));
    console.log('onMessage');
    console.log(msg);
}

function onError(event) {
    console.log('onError event', event);
}

function doSend(message) {
    console.log('doSend message');
    console.log(message);
    websocket.send(msgpack.encode(message));
}

        </script>
    </body>
</html>
